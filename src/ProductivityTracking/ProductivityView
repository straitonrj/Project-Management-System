using System;
using System.Windows.Forms;
using ProjectMgmtApp;  // ViewModel namespace â€” change if your namespace differs

namespace ProjectMgmtApp
{
    public partial class ProductivityView : Form
    {
        // ViewModel instance that handles DB interaction and logic
        private ProductivityViewModel viewModel = new ProductivityViewModel();

        // Constructor: sets up UI and pre-loads any saved productivity entries
        public ProductivityView()
        {
            InitializeComponent();  // Load WinForms designer elements
            LoadData();             // Populate DataGridView with current records
        }

        // Load all productivity records from the database and show in DataGridView
        private void LoadData()
        {
            dataGridView1.DataSource = viewModel.GetAllEntries(); // Pulls from SQLite via ViewModel
        }

        // This is triggered when the "Add Entry" button is clicked
        private void btnAdd_Click(object sender, EventArgs e)
        {
            try
            {
                // Create a new productivity entry using input from the form
                var entry = new ProductivityEntry
                {
                    Project = txtProject.Text,
                    PhaseName = txtPhase.Text,
                    WeeklyHours = int.Parse(txtWeeklyHours.Text),
                    TotalHours = int.Parse(txtTotalHours.Text),
                    Description = txtDescription.Text
                };

                // Save entry to the database (will be tied to UserID = 1 internally)
                viewModel.AddEntry(entry);

                // Reload data grid to include the new entry
                LoadData();

                // Clear input fields for the next use
                ClearInputs();
            }
            catch (Exception ex)
            {
                MessageBox.Show("Failed to add entry. Check your input.\n\n" + ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        // Utility function to reset form fields to blank/zero
        private void ClearInputs()
        {
            txtProject.Clear();
            txtPhase.Clear();
            txtWeeklyHours.Clear();
            txtTotalHours.Clear();
            txtDescription.Clear();
        }
    }
}

